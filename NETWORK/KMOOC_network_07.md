# CH.07 IP주소 자동할당, 변환과 주소매핑, 에러보고

# DHCP 와 NAT

### DHCP(Dynamic Host Configuration Protocol)

소규모의 네트워크의 경우 IP주소를 직접 분배할 수 있지만 대규모의 네트워크는 직접 분배와 관리가 어려워 DHCP를 통해 분배 및 관리한다.
> IP를 보다 효율적으로 할당하고 관리하기 위해 필요

* DHCP는 정적 및 동적 할당을 제공

* 동적 주소 할당

* 정적 주소 할당 : 특정 서버의 경우 IP를 정해놓고 쓰겠다고 정함, MAC주소를 보고 판단함

### NAT(Network Address Translation)
공인 IP 주소 부족, 외부망으로부터 내부망을 보호하고(내부망의 IP와 외부망의 IP를 분리) ISP(인터넷 서비스 제공자, Internet Service Provider)변경에 따른 내부 IP변경을 최소화 하기 위해 사용된다.

* 3 개의 주소 세트를 개인 주소로 정해 놓음 : 비공인 주소를 지정, 이러한 주소를 내부에서 사용하고 외부로 나갈때는 NAT를 사용해 나간다.
  * 10.0.0.0 to 10.255.255.255 
  * 172.16.0.0 to 172.31.255.255
  * 192.168.0.0 to 192.168.255.255

* 공인주소도 정적NAT, 동적NAT가 존재해 그때 마다 변경이 가능하다.

## 주소 매핑(Address mapping)
IP 주소는 논리적인 주소로, 인터넷에 접속된 컴퓨터를 구분하는 역할
 * 인터넷 전체에서는 IP주소로 식별
 
Ethernet 주소는 물리적인 주소로, 해당 LAN에 접속된 컴퓨터를 구분하는 역할
 * MAC 주소는 LAN에서만 유일하게 식별
 * MAC 주소는 LAN내에서 각 장치 구분
 
주소 매핑이란, 내 IP주소와 내 이더넷 주소 랜카드에 있는 MAC 주소와 상대방의 IP주소와 상대방 MAC주소를 서로 연결시키는 것이다. 연결시켜야
메시지를 주고받을 수 있기 때문이다.

### 정적 매핑 (Static mapping)
IP주소와 MAC 주소를 연결시키는 테이블을 고정적으로 생성하는 방법
* 수작업으로 직접 입력도 가능

* 단점 : 수작업으로 입력이 현실적으로 어렵고, 노트북같은 경우는 계속 아이피가 바뀔 수 있다. 또한 랜카드를 바꿔버린다면 MAC주소가 변경되어
다시 설정해야함.

### 동적 매핑 (Dynamic mapping)
컴퓨터가 매번 IP주소와 MAC 주소의 관계를 프로토콜을 이용하여 구한다.

* ARP(Address Resolution Protocol) : IP주소에 대응하는 MAC주소를 구하는 프로토콜, 상대방의 IP은 알지만 MAC을 모를때 사용

> 즉 ARP로 알아 내야할 MAC주소의 IP주소를 뿌려서 알아내면 해당 IP에 매핑을 시키기 때문에 주소 매핑이라고 한다. 

# 에러보고(ICMP, The Internet Control Message Protocol)
IP의 단점을 보완하기 위해서 제공, IP 에러제어와 관리 기능이 부족하여 이를 보완하기 위해 제공된다.

* 에러 보고 메시지(Error-reporting messages) : 들어오는 데이터에 에러가 있는지 없는지 확인

* 질의응답 메시지(Query message) : 네트웍의 인터넷 프로토콜이 제대로 동작하는지 알아보기 위한 것

ICMP는 에러를 정정하지는 않고 단순히 보고만 수행한다.

### 에러 보고 기능
* 목적지 도달 불가(Destination unreachable)
  * IP 패킷을 전달할 수 없을 때, 해당 패킷은 폐기
  * 목적지 도달불가 메시지를 송신지로 전송
  
* 송신지 조절(Source quench)
  * 라우터나 컴퓨터는 혼잡이 발생하면 해당 패킷은 폐기 : 너무 많이 들어오면 없애버림
  * 송신지로 송신지 조절 메시지 전송 : 너무 많아.. 좀 줄여 (수도꼭지를 틀어 막듯이 알려준다)
  
* 시간 초과(Time exceeded)
  * 라우터는 TTL 필드의 값이 0인 패킷은 폐기 : TTL은 통신장치를 거칠때마다 1씩(일반적으로) 감소
  * 송신지로 시간초과 메시지가 발생 : TTL이 0이 되면 알려줌 
  * 단편화된 메시지가 모두 도착하지 못해 완전한 하나의 패킷을 조합할 수 없을때 시간 초과 메시지가 발생 : 단편화되어서 오면, 어차피 안될거 버리고 알려줌 
  
* 파라미터 문제(Parameter problem)
  * IP 패킷 헤더의 정보 중에서 처리할 수 없는 부분을 발견시
  
* 경로 재설정 (Redirection)
  * 잘못된 라우터로 패킷을 전달하는 경우
  
## 질의 응답(Query) : 관리 기능
ICMP는 네트워크 문제를 진단하기 위한 행위를 할 수 있음

* 에코 요청 및 응답(Echo request and reply) : 네트워크가 문제가 있는지 체크하는 것, 야 너 죽었어? 살았어? 살아있는거 맞아? Request하면 reply가 와야하는거니까.
  * ex) ping(핑) : 원격지의 컴퓨터가 살아있는지 죽어있는지 체크하는데 많이 사용

* 타임 스탬프 요청 및 응답(Time-stamp request and reply) : 야 너 지금 시간이 어떻게 돼?

* 주소 마스크 요청 및 응답(Address mask request and reply) : 마스크 값이 어떻게 돼?

* 라우터 요청 및 응답(Router solicitation and advetisement) : 라우팅 정보를 요청하고 그것에 대한 응답


  
  
